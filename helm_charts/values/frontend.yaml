---
SDPSN-devops-charts:
  name: frontend

  deployment:
    image: ghcr.io/dnum-socialgouv/sirena:latest-frontend
    imagePullSecretsName: registry-secret

    readinessProbe:
      enable: false
    livenessProbe:
      enable: true
      initialDelaySeconds: 30
      periodSeconds: 30
      path: /
      timeoutSeconds: 5

    resources:
      limits:
        cpu: 250m
        memory: 900Mi
      requests:
        cpu: 250m
        memory: 900Mi

  enableSecurityHeaders: true
  securityHeaders:
    Content-Security-Policy: >-
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://matomo.fabrique.social.gouv.fr;
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https:;
      font-src 'self' data:;
      connect-src 'self' https://matomo.fabrique.social.gouv.fr https://sentry2.fabrique.social.gouv.fr;
      worker-src 'self' blob:;
      frame-ancestors 'none'

  ingress:
    enable: true
    name: frontend
    ingressClassName: public
    host: sirena.formation.prod.atlas.fabrique.social.gouv.fr
    appAnnotations:
      nginx.ingress.kubernetes.io/proxy-body-size: 200m
      nginx.ingress.kubernetes.io/proxy-hide-headers: Server
    paths:
      - path: /
        pathType: Prefix
        serviceName: frontend
        servicePort: 80
    tls:
      hosts:
        - sirena.formation.prod.atlas.fabrique.social.gouv.fr
      secretName: frontend-tls
